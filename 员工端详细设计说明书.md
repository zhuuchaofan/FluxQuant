**FluxQuant** **员工端详细设计说明书** **(Execution Layer)**

文档状态: Draft

对应角色: 数据专员 / 操作员 / 开发者

核心目标: 极低摩擦录入 (Low Friction)、高频正反馈 (High Feedback)、免责机制数字化

**1.** **设计哲学** **(Design Philosophy)**

在传统的 ERP 或工时系统中，员工是被动的“数据录入机器”。在 FluxQuant 中，我们将填报行为游戏化（Gamification）：

- **消除恐惧**: 遇到坏数据（无法处理的任务）时，不仅不扣分，反而视为一种“对于数据清洗的贡献”。
- **即时满足**: 每一次提交，进度条必须实时响应（无需等待服务器）。
- **私密性**: 员工端只关注“我的流”，屏蔽项目整体的复杂性。

**2.** **核心界面：工作流视图** **(My Stream)**

**2.1** **布局架构**

采用 **"****单列卡片流****"** 布局，适配桌面端与移动端。

- **顶部导航**:
  - 左侧: FluxQuant Logo
  - 右侧: 今日产出: 320 (实时跳动的数字计数器) | 用户头像
- **主体区域**:
  - **Filter (****过滤器****)**: 全部任务 | 进行中 | 已完成
  - **Card List**: 垂直排列的分配任务卡片。

**2.2** **任务卡片设计** **(The Task Card)**

每张卡片代表一个 Allocation 实例。

| **区域**   | **元素**                   | **逻辑****/****说明**                                 |
| ---------- | -------------------------- | ----------------------------------------------------- |
| **Header** | 阶段标签                   | 如 [数据清洗]，颜色区分阶段。                         |
|            | 任务名称                   | 如 2026Q1_合同扫描件_批次A。                          |
| **Body**   | 进度仪表盘                 | 环形图或条形图。显示 已完成 / 目标量 (如 150 / 200)。 |
|            | 剩余提示                   | 还需 50 个单位。                                      |
| **Action** | **“****汇报****”****按钮** | **主交互点**。大尺寸、高对比度按钮。                  |
| **Footer** | 历史摘要                   | 显示最近一次提交：今天 10:30 (+20)。                  |

**3.** **核心交互：沉浸式填报** **(The Reporting Flow)**

点击“汇报”按钮后，不跳转页面，而是弹出一个**半屏模态窗** **(Bottom Sheet / Modal)**。

**3.1** **填报模态窗** **(Report Modal)**

**A** **区：日期确认**

- 默认选中“今天”。
- 允许回溯选择“昨天”或“前天”（补报模式，需在后台标记 IsBackfill: true）。

**B** **区：有效产出** **(Valid Output)**

- **文案**: "今天搞定了多少？"
- **组件**: 大字号数字输入框。
- **快捷键**: +10, +50, Max (填满剩余量)。

**C** **区：异常****/****除外** **(Exceptions / Exclusions) ——** **关键设计**

- **默认状态**: 折叠收起，文案 "遇到无法处理的数据？"。
- **展开状态**:
  1. **数量**: 输入除外数量（如 5）。
  2. **原因** **(****必选****)**: Dropdown 选择。
     - 源文件损坏 / 无法打开
     - 数据重复 / 已存在
     - 信息缺失 / 无法辨认
     - 其他 (需备注)

1. **备注**: Textarea，用于粘贴坏数据的文件名或 ID。

**D** **区：提交反馈**

- 按钮文案动态变化: 提交 (总进度将升至 82%) 🚀。

**3.2** **交互时序** **(Sequence)**

1. **User**: 输入 Valid: 50, Excluded: 5 -> 点击提交。
2. **Frontend (Next.js)**:
   - **Optimistic UI**: 立即关闭弹窗，卡片进度条瞬间涨到 82%，顶部计数器 +55。
   - **Animation**: 播放轻微的粒子效果 (Confetti)。

1. **Backend (API)**:

- 接收 POST 请求。
- 写入 ProductionLog。
- 原子更新 Allocation 快照。

1. **Error Handling**:

- 若 API 失败，前端 Toast 提示 "网络开小差了，正在重试..." 并自动重试 3 次。
- 若最终失败，回滚进度条，并标记卡片为 "同步失败"。

**4.** **辅助功能：修正与历史** **(Correction & History)**

**4.1** **历史记录** **(Log Stream)**

点击卡片的“历史摘要”区域，进入该任务的详细流水页。

- 列表显示:
  - 1/17 14:00 | +50 有效 | 0 异常
  - 1/16 18:00 | +0 有效 | +10 异常 (源文件损坏)
- **撤回****/****修正**:
  - 仅允许修改 **24****小时内** 的记录。
  - 操作逻辑: 实际上是生成一条**负数**的冲销日志 (Revert Log)，保证审计痕迹。

**5.** **数据逻辑与防呆** **(Logic & Validation)**

**5.1** **输入校验**

- **超额预警**: 若 (已完成 + 本次输入) > 分配总量 * 1.1 (允许溢出 10%)。
  - 提示: "你的输入超过了分配任务量，请确认是否多输了？" -> 允许强制提交，但标记 IsOverQuota。
- **负数拦截**: 不允许输入负数（修正需走撤回流程）。

**5.2** **状态流转**

- 当 Valid + Excluded >= TargetQuota 时，卡片自动标记为 **"****已达标** **(Completed)"**，并沉底显示。

**6.** **预期交付成果** **(Deliverables)**

1. **组件库**: 封装好的 TaskCard, ReportModal 组件。
2. **API** **接口**:
   - GET /api/my/allocations (获取我的任务流)
   - POST /api/report (核心填报接口)
   - GET /api/report/history/{allocationId} (获取流水)

1. **体验指标**:

- 填报耗时 < 5秒。
- 异常归因覆盖率 100% (所有除外量都有对应的 Reason)。